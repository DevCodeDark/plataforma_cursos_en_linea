<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Dashboard Administrativo - AstroDev Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" rel="stylesheet">
    <link th:href="@{/css/admin-dashboard.css}" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-rocket me-2"></i>AstroDev</h4>
            <small>Panel Administrativo</small>
        </div>
        
        <ul class="sidebar-nav">
            <li>
                <a href="#dashboard" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>Dashboard
                </a>
            </li>
            <li>
                <a href="#usuarios" class="nav-link" data-section="usuarios">
                    <i class="fas fa-users"></i>Usuarios
                </a>
            </li>
            <li>
                <a href="#cursos" class="nav-link" data-section="cursos">
                    <i class="fas fa-graduation-cap"></i>Cursos
                </a>
            </li>
            <li>
                <a href="#roles" class="nav-link" data-section="roles">
                    <i class="fas fa-user-shield"></i>Roles
                </a>
            </li>
            <li>
                <a href="#reportes" class="nav-link" data-section="reportes">
                    <i class="fas fa-chart-bar"></i>Reportes
                </a>
            </li>
            <li>
                <a href="#configuracion" class="nav-link" data-section="configuracion">
                    <i class="fas fa-cog"></i>Configuración
                </a>
            </li>
            <li>
                <hr class="sidebar-separator">
            </li>
            <li>
                <a th:href="@{/astrodev/inicio}">
                    <i class="fas fa-home"></i>Volver al Sitio
                </a>
            </li>
            <li>
                <a th:href="@{/auth/logout}">
                    <i class="fas fa-sign-out-alt"></i>Cerrar Sesión
                </a>
            </li>
        </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Navbar -->
        <nav class="top-navbar">
            <div class="d-flex align-items-center">
                <button class="sidebar-toggle me-3" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="navbar-brand h5 mb-0">Dashboard Administrativo</span>
            </div>
            
            <div class="user-menu">
                <span class="me-2" sec:authentication="principal.username">Admin</span>
                <div class="user-avatar">
                    <span sec:authentication="principal.username" th:text="${#strings.substring(#authentication.principal.username, 0, 1)}">A</span>
                </div>
            </div>
        </nav>
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section">
            <h2 class="section-title">Panel de Control</h2>
            
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6">
                    <div class="dashboard-card stat-card">
                        <div class="stat-icon stat-icon-usuarios">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number" th:text="${totalUsuarios ?: '0'}">0</div>
                        <div class="stat-label">Total Usuarios</div>
                    </div>
                </div>
                
                <div class="col-md-3 col-sm-6">
                    <div class="dashboard-card stat-card">
                        <div class="stat-icon stat-icon-cursos">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="stat-number" th:text="${totalCursos ?: '0'}">0</div>
                        <div class="stat-label">Total Cursos</div>
                    </div>
                </div>
                
                <div class="col-md-3 col-sm-6">
                    <div class="dashboard-card stat-card">
                        <div class="stat-icon stat-icon-inscripciones">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="stat-number" th:text="${totalInscripciones ?: '0'}">0</div>
                        <div class="stat-label">Inscripciones</div>
                    </div>
                </div>
                
                <div class="col-md-3 col-sm-6">
                    <div class="dashboard-card stat-card">
                        <div class="stat-icon stat-icon-ingresos">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-number" th:text="${ingresosMensuales ?: '0'}">$0</div>
                        <div class="stat-label">Ingresos del Mes</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="row">
                <div class="col-md-8">
                    <div class="dashboard-card">
                        <h5>Inscripciones por Mes</h5>
                        <div class="chart-container">
                            <canvas id="inscripcionesChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="dashboard-card">
                        <h5>Usuarios por Rol</h5>
                        <div class="chart-container">
                            <canvas id="rolesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="dashboard-card">
                <h5>Actividad Reciente</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Actividad</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="actividad : ${actividadReciente}">
                                <td th:text="${actividad.usuario}">Usuario</td>
                                <td th:text="${actividad.descripcion}">Actividad</td>
                                <td th:text="${#temporals.format(actividad.fecha, 'dd/MM/yyyy HH:mm')}">Fecha</td>
                                <td>
                                    <span class="badge-status badge-activo" th:if="${actividad.exitosa}">Exitoso</span>
                                    <span class="badge-status badge-inactivo" th:unless="${actividad.exitosa}">Error</span>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(actividadReciente)}">
                                <td colspan="4" class="text-center text-muted">No hay actividad reciente</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Usuarios Section -->
        <div id="usuarios-section" class="content-section hidden">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="section-title mb-0">Gestión de Usuarios</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#nuevoUsuarioModal">
                    <i class="fas fa-plus me-2"></i>Nuevo Usuario
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Último Acceso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="usuario : ${usuarios}">
                                <td th:text="${usuario.id}">1</td>
                                <td th:text="${usuario.nombreCompleto}">Juan Pérez</td>
                                <td th:text="${usuario.email}">juan@email.com</td>
                                <td th:text="${usuario.rolNombre}">Estudiante</td>
                                <td>
                                    <span class="badge-status" 
                                          th:classappend="${usuario.estaActivo ? 'badge-activo' : 'badge-inactivo'}"
                                          th:text="${usuario.estado}">Activo</span>
                                </td>
                                <td th:text="${usuario.ultimoAcceso != null ? #temporals.format(usuario.ultimoAcceso, 'dd/MM/yyyy') : 'Nunca'}">01/01/2024</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary btn-action" 
                                            th:onclick="'editarUsuario(' + ${usuario.id} + ')'">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger btn-action"
                                            th:onclick="'eliminarUsuario(' + ${usuario.id} + ')'">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Cursos Section -->
        <div id="cursos-section" class="content-section hidden">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="section-title mb-0">Gestión de Cursos</h2>
                <button class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Nuevo Curso
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Título</th>
                                <th>Instructor</th>
                                <th>Categoría</th>
                                <th>Estudiantes</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="curso : ${cursos}">
                                <td th:text="${curso.id}">1</td>
                                <td th:text="${curso.titulo}">Java Básico</td>
                                <td th:text="${curso.instructorNombre}">Prof. García</td>
                                <td th:text="${curso.categoriaNombre}">Programación</td>
                                <td th:text="${curso.totalInscripciones}">25</td>
                                <td>
                                    <span class="badge-status badge-activo" th:if="${curso.activo}">Activo</span>
                                    <span class="badge-status badge-inactivo" th:unless="${curso.activo}">Inactivo</span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary btn-action">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger btn-action">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Roles Section -->
        <div id="roles-section" class="content-section hidden">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="section-title mb-0">Gestión de Roles</h2>
                <button class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Nuevo Rol
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Descripción</th>
                                <th>Usuarios</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="rol : ${roles}">
                                <td th:text="${rol.id}">1</td>
                                <td th:text="${rol.nombre}">Administrador</td>
                                <td th:text="${rol.descripcion}">Acceso completo al sistema</td>
                                <td th:text="${rol.cantidadUsuarios}">5</td>
                                <td>
                                    <span class="badge-status" 
                                          th:classappend="${rol.estado == 1 ? 'badge-activo' : 'badge-inactivo'}"
                                          th:text="${rol.estado == 1 ? 'Activo' : 'Inactivo'}">Activo</span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary btn-action">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger btn-action">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Other sections would go here... -->
        <div id="reportes-section" class="content-section hidden">
            <h2 class="section-title">Reportes y Estadísticas</h2>
            <p>Sección de reportes en desarrollo...</p>
        </div>
        
        <div id="configuracion-section" class="content-section hidden">
            <h2 class="section-title">Configuración del Sistema</h2>
            <p>Sección de configuración en desarrollo...</p>        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:src="@{/js/admin-dashboard.js}"></script>
</body>
</html>
